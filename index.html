<!-- ============================
     index.html  (FINAL)
============================= -->
<!doctype html>
<html lang="tr">
<head> 
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Belido Stok Paneli</title>

  <!-- Styles -->
   <link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#253e27">
  <link rel="stylesheet" href="styles.css" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar">
  <div class="sb-brand">
    <img src="logo.png" alt="Belido" class="logo">
    <div class="brand-text">
      <strong>Belido</strong>
      <span>Stok YÃ¶netimi</span>
    </div>
  </div>

  <div class="sb-user">
    <span id="userEmail">...</span>
    <button id="btnLogout" class="btn danger w-full">Ã‡Ä±kÄ±ÅŸ</button>
  </div>

  <nav class="sb-nav">
    <button class="sb-link" data-tab="dashboard">Dashboard</button>
    <button class="sb-link" data-tab="giris">Mal GiriÅŸi</button>
    <button class="sb-link" data-tab="cikis">Mal Ã‡Ä±kÄ±ÅŸÄ±</button>
    <button class="sb-link" data-tab="tanklar">Tanklar</button>
    <button class="sb-link" data-tab="tedarikci">TedarikÃ§iler</button>
    <button class="sb-link" data-tab="rapor">Raporlar</button>
    <button class="sb-link admin-only" data-tab="ayarlar">Ayarlar</button>
  </nav>
  <div class="sb-footer">
  <span class="oz-soft">
    <span class="line-left"></span>
    <span class="text">Oz YazÄ±lÄ±m</span>
    <span class="line-right"></span>
  </span>
</div>

</aside>

<!-- HEADER -->
<header class="header">
  <div class="header-left">
    <button id="menuToggle" class="btn icon mobile-only">â˜°</button>
    <img src="logo.png" alt="Belido" class="logo-sm">
    <h1>Stok Panel</h1>
  </div>
  <div class="header-right">
    <span id="currentRole" class="pill">role: â€¦</span>
  </div>
</header>

<!-- MAIN -->
<main class="container layout">

  <!-- DASHBOARD -->
  <section id="dashboard" class="tab">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-title">Toplam Stok (KG)</div>
        <div id="statTotalStock" class="stat-value">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">BugÃ¼nkÃ¼ GiriÅŸ (KG)</div>
        <div id="statTodayIn" class="stat-value">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">BugÃ¼nkÃ¼ Ã‡Ä±kÄ±ÅŸ (KG)</div>
        <div id="statTodayOut" class="stat-value">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Ort. Asit / K232 / Î”K</div>
        <div class="stat-stack">
          <span id="statAvgAcid">0.0000</span>
          <span id="statAvgK232">0.0000</span>
          <span id="statAvgDeltaK">0.0000</span>
        </div>
      </div>
    </div>

    <div class="grid-2">
      <div class="card">
        <h3>Son 10 GiriÅŸ</h3>
        <table id="entryTable">
          <thead>
            <tr>
              <th>Tarih</th><th>FiÅŸ</th><th>TedarikÃ§i</th><th>Tank</th><th>KG</th><th>Asit</th><th>Ä°ÅŸlem</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card">
        <h3>Son 10 Ã‡Ä±kÄ±ÅŸ</h3>
        <table id="exitTable">
          <thead>
            <tr>
              <th>Tarih</th><th>Tank</th><th>KG</th><th>AÃ§Ä±klama</th><th>Ä°ÅŸlem</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- MAL GÄ°RÄ°ÅÄ° -->
  <section id="giris" class="tab">
    <h2>Mal GiriÅŸi</h2>
    <form id="entryForm" class="card form-grid">
      <label>Tarih<input type="date" name="date" required /></label>
      <label>FiÅŸ No<input type="text" name="fis_no" /></label>
      <label>TedarikÃ§i<select name="supplier_id" id="supplierSelect" required></select></label>
      <label>Tank<select name="tank_id" id="tankSelect1" required></select></label>

      <label>Kalite
        <select name="kalite" required>
          <option value="EXTRA V.">EXTRA V.</option>
          <option value="NATURAL 1.">NATURAL 1.</option>
          <option value="HAM">HAM</option>
        </select>
      </label>

      <label>Asit (%)<input type="number" step="0.0001" name="acid" required /></label>
      <label>K232<input type="number" step="0.0001" name="k232" /></label>
      <label>Î”K<input type="number" step="0.0001" name="delta_k" /></label>
      <label>KG<input type="number" step="0.001" name="kg" required /></label>
      <label>Birim Fiyat<input type="number" step="0.01" name="price" /></label>
      <label>Komisyon<input type="number" step="0.01" name="komisyon" /></label>
      <label class="full">AÃ§Ä±klama<input type="text" name="aciklama" /></label>

      <div class="form-actions full">
        <button class="btn primary">Kaydet</button>
        <p class="muted" id="entryMsg"></p>
      </div>
    </form>

    <div class="card">
      <h3>GiriÅŸler</h3>
      <table id="entryTableFull">
        <thead>
          <tr>
            <th>Tarih</th><th>FiÅŸ</th><th>TedarikÃ§i</th><th>Tank</th><th>KG</th><th>Asit</th><th>Fiyat</th><th>Ä°ÅŸlem</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- MAL Ã‡IKIÅI -->
  <section id="cikis" class="tab">
    <h2>Mal Ã‡Ä±kÄ±ÅŸÄ±</h2>
    <form id="exitForm" class="card form-grid">
      <label>Kalite
  <select name="kalite" required>
    <option value="EXTRA V.">EXTRA V.</option>
    <option value="NATURAL 1.">NATURAL 1.</option>
    <option value="HAM">HAM</option>
  </select>
</label>

      <label>Tarih<input type="date" name="date" required /></label>
      <label>Tank<select name="tank_id" id="tankSelect2" required></select></label>
      <label>KG<input type="number" step="0.001" name="kg" required /></label>
      <label>SatÄ±ÅŸ FiyatÄ±<input type="number" step="0.01" name="price" /></label>
      <label>Komisyon<input type="number" step="0.01" name="komisyon" /></label>
      <label>Fatura No<input type="text" name="invoice_no" /></label>
      <label class="full">AÃ§Ä±klama<input type="text" name="description" /></label>
      

      <div class="form-actions full">
        <button class="btn primary">Kaydet</button>
        <p class="muted" id="exitMsg"></p>
      </div>
    </form>

    <div class="card">
      <h3>Ã‡Ä±kÄ±ÅŸlar</h3>
      <table id="exitTableFull">
        <thead>
          <tr>
            <th>Tarih</th><th>Tank</th><th>KG</th><th>Fiyat</th><th>Komisyon</th><th>Fatura</th><th>AÃ§Ä±klama</th><th>Ä°ÅŸlem</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

<!-- TANKLAR -->
<section id="tanklar" class="tab">
  <h2>Tanklar</h2>

  <!-- TANK EKLEME FORMU -->
  <form id="tankForm" class="card form-grid">
    <label>Tank AdÄ±
      <input type="text" name="tank_name" required />
    </label>

    <label>Kapasite (KG)
      <input type="number" step="0.001" name="capacity_kg" required />
    </label>

    <div class="form-actions">
      <button class="btn secondary">Yeni Tank Ekle</button>
      <p class="muted" id="tankMsg"></p>
    </div>
  </form>

  <!-- 3D TANK GÃ–RÃœNÃœMÃœ -->
  <div class="card">
    <h3>Kalite BazlÄ± 3D GÃ¶rÃ¼nÃ¼m</h3>

    <div class="legend">
      <span><i class="chip chip-extra"></i> EXTRA V.</span>
      <span><i class="chip chip-natural"></i> NATURAL 1.</span>
      <span><i class="chip chip-ham"></i> HAM</span>
    </div>

    <!-- ğŸ“Œ JS Bu ID'yi kullanÄ±yor (DOÄRU OLAN) -->
    <div id="tank3DContainer" class="tank-viz-grid"></div>
  </div>
  <!-- 5) (Ä°steÄŸe baÄŸlÄ±) Tanklar bÃ¶lÃ¼mÃ¼ne arÅŸiv tablosu ekle -->
<div class="card">
  <h3>ArÅŸiv (Silinen Tanklar)</h3>
  <table id="tankArchiveTable">
    <thead>
      <tr>
        <th>Tank</th><th>Kapasite</th><th>Mevcut (Hesap)</th><th>Durum</th><th>Ä°ÅŸlem</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


  <!-- TANK TABLOSU -->
  <div class="card">
    <table id="tankTable">
      <thead>
        <tr>
          <th>Tank</th>
          <th>Kapasite</th>
          <th>Mevcut KG</th>
          <th>Doluluk %</th>
          <th>Ort. Asit</th>
          <th>Ort. K232</th>
          <th>Ort. Î”K</th>
          <th>Ä°ÅŸlem</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</section>

  <!-- TEDARÄ°KÃ‡Ä°LER -->
  <section id="tedarikci" class="tab">
    <h2>TedarikÃ§iler</h2>

    <form id="supplierForm" class="card form-grid">
      <label>Ä°sim<input type="text" name="name" required /></label>
      <label>Adres<input type="text" name="address" /></label>
      <label>Telefon<input type="text" name="phone" /></label>
      <label>Not<input type="text" name="note" /></label>
      <div class="form-actions">
        <button class="btn secondary">Ekle</button>
        <p class="muted" id="supplierMsg"></p>
      </div>
    </form>

    <div class="card">
      <table id="supplierTable">
        <thead>
          <tr><th>Ä°sim</th><th>Adres</th><th>Telefon</th><th>Not</th><th>Ä°ÅŸlem</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- RAPORLAR -->
  <section id="rapor" class="tab">
    <h2>Raporlar</h2>

    <div class="card form-grid">
      <label>BaÅŸlangÄ±Ã§<input type="date" id="repStart"></label>
      <label>BitiÅŸ<input type="date" id="repEnd"></label>
      <label>TÃ¼r
        <select id="repType">
          <option value="range">Tarih AralÄ±ÄŸÄ±</option>
          <option value="daily">GÃ¼nlÃ¼k</option>
          <option value="weekly">HaftalÄ±k</option>
          <option value="by_quality">Kalite BazlÄ±</option>
          <option value="by_supplier">TedarikÃ§i BazlÄ±</option>
          <option value="by_tank">Tank BazlÄ±</option>
        </select>
      </label>
      <button id="btnRunReport" class="btn secondary">Raporu Ã‡alÄ±ÅŸtÄ±r</button>
      <button id="btnExcel" class="btn">Excelâ€™e Aktar</button>
      <div class="stats" id="reportStats"></div>
    </div>

    <div class="card">
      <h3>Ã–zet</h3>
      <table id="reportTable">
        <thead>
          <tr>
            <th>Tank</th><th>Toplam GiriÅŸ</th><th>Toplam Ã‡Ä±kÄ±ÅŸ</th><th>Net Stok</th>
            <th>Ort. Asit</th><th>Ort. K232</th><th>Ort. Î”K</th>
            <th>Ort. AlÄ±ÅŸ</th><th>Ort. SatÄ±ÅŸ</th><th>KG BaÅŸÄ±na KÃ¢r</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- AYARLAR (admin) -->
  <section id="ayarlar" class="tab">
    <h2>Ayarlar</h2>
    <div class="card">
      <p>Admin kullanÄ±cÄ±larÄ±, roller ve politikalar burada yÃ¶netilecek.</p>
    </div>
  </section>

</main>

<!-- MODALS -->
<div id="editModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-head">
      <h3>DÃ¼zenle</h3>
      <button class="btn icon" onclick="closeEdit()">âœ•</button>
    </div>
    <form id="editForm" class="form-grid"></form>
    <div class="modal-actions">
      <button class="btn primary" onclick="saveEdit()">Kaydet</button>
      <button class="btn" onclick="closeEdit()">Kapat</button>
    </div>
  </div>
</div>

<div id="confirmModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-head">
      <h3>Onay</h3>
      <button class="btn icon" onclick="closeConfirm()">âœ•</button>
    </div>
    <p id="confirmText">Silmek istediÄŸinize emin misiniz?</p>
    <div class="modal-actions">
      <button class="btn danger" id="confirmYes">Evet, Sil</button>
      <button class="btn" onclick="closeConfirm()">VazgeÃ§</button>
    </div>
  </div>
</div>

<!-- APP -->
<script src="app.js"></script>
<script>
  // Ä°lk yÃ¼kte dashboard aÃ§Ä±k kalsÄ±n
  window.addEventListener("load", () => {
    const first = localStorage.getItem("activeTab") || "dashboard";
    activateTab(first);
  });
</script>
<nav class="mobile-nav">
  <button data-tab="dashboard">ğŸ </button>
  <button data-tab="giris">â¬†ï¸</button>
  <button data-tab="cikis">â¬‡ï¸</button>
  <button data-tab="tanklar">ğŸ›¢ï¸</button>
  <button data-tab="rapor">ğŸ“Š</button>
</nav>

</body>
</html>
